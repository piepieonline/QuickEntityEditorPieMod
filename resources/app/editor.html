<!DOCTYPE html>
<html class="h-full bg-gray-800 text-white overflow-hidden">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#fdf4ff">
	<link rel="stylesheet" href="treeview.css">
	<link rel="stylesheet" href="tailwind.min.css">
	<link rel="stylesheet" data-name="vs/editor/editor.main" href="node_modules/monaco-editor/min/vs/editor/editor.main.css">
	<title>QuickEntity</title>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap"
		rel="stylesheet">
	<script src="https://kit.fontawesome.com/8b911cebd0.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="colourpicker.min.css"/>
	<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
	<script defer src="https://unpkg.com/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs"></script>
    <style>
        input:disabled {
            background: rgb(231, 231, 231);
        }

		@keyframes reminder {
			0%, 100% {
				transform: scale(1);
				animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
			}
			50% {
				transform: scale(1.5);
				animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
			}
		}
    </style>
</head>

<body style="font-family: Inter; text-underline-position: under;">
	<script src="three-onlymath.min.js"></script>
	<script src="jstree.min.js"></script>
	<script src="curve-editor.js"></script>

	<section class="flex justify-center mt-8">
		<img src="logo.png" style="width: 20rem;" alt="">
	</section>

	<section class="grid grid-cols-8 gap-8 mt-8 mx-4 w-full" style="max-width: 98vw">
		<div class="col-span-1" x-data="{viewsOpen: true, actionsOpen: true, selectedView: 'tree'}">
			<div class="flex justify-between items-center">
				<span class="text-3xl font-semibold mb-2 w-full">Views</span>
				<svg x-show="!viewsOpen" @click="viewsOpen = true" class="fill-current" viewBox="0 0 24 24" width="24" height="24">
					<path class="heroicon-ui"
						d="M12 22a10 10 0 110-20 10 10 0 010 20zm0-2a8 8 0 100-16 8 8 0 000 16zm1-9h2a1 1 0 010 2h-2v2a1 1 0 01-2 0v-2H9a1 1 0 010-2h2V9a1 1 0 012 0v2z" />
				</svg>
				<svg x-show="viewsOpen" @click="viewsOpen = false" class="fill-current" viewBox="0 0 24 24" width="24" height="24">
					<path class="heroicon-ui"
						d="M12 22a10 10 0 110-20 10 10 0 010 20zm0-2a8 8 0 100-16 8 8 0 000 16zm4-8a1 1 0 01-1 1H9a1 1 0 010-2h6a1 1 0 011 1z" />
				</svg>
				<br>
			</div>

			<div x-show="viewsOpen" x-collapse>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.1="selectedView = 'metadata'; changeView('metadata')" @click="selectedView = 'metadata'; changeView('metadata')" id="metadataTab">
					<i class="fas fa-cog col-span-1"></i>
					<span class="col-span-7">Metadata</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.2="selectedView = 'overrides'; changeView('overrides')" @click="selectedView = 'overrides'; changeView('overrides')" id="overridesTab">
					<i class="fas fa-wrench col-span-1"></i>
					<span class="col-span-7">Overrides</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.4="selectedView = 'graph'; changeView('graph')" @click="selectedView = 'graph'; changeView('graph')" id="graphTab">
					<i class="fas fa-project-diagram col-span-1"></i>
					<span class="col-span-7">Graph View</span>
				</div>
				<div class="p-4 my-1 bg-black cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.3="selectedView = 'tree'; changeView('tree')" @click="selectedView = 'tree'; changeView('tree')" id="treeTab"
																									@keyup.window.prevent.ctrl.page-up="editorTree.close_all()" @keyup.window.prevent.ctrl.page-down="editorTree.open_all()"
																									@keyup.window.prevent.alt.arrow-left="back()"
																									@keyup.window.prevent.ctrl.b="switchEditMode()">
					<i class="far fa-folder col-span-1"></i>
					<span class="col-span-7">Tree View</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.4="selectedView = 'pieGraph'; changeView('pieGraph')" @click="selectedView = 'pieGraph'; changeView('pieGraph')" id="pieGraphTab">
					<i class="fas fa-project-diagram col-span-1"></i>
					<span class="col-span-7">Pie Graph View</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" @keyup.window.prevent.ctrl.4="selectedView = 'pie3DView'; changeView('pie3DView')" @click="selectedView = 'pie3DView'; changeView('pie3DView')" id="pie3DViewTab">
					<i class="fas fa-project-diagram col-span-1"></i>
					<span class="col-span-7">Pie 3D View</span>
				</div>
				<br>
			</div>

			<div class="flex justify-between items-center">
				<span class="text-3xl font-semibold mb-2 w-full">Actions</span>
				<svg x-show="!actionsOpen" @click="actionsOpen = true" class="fill-current" viewBox="0 0 24 24" width="24" height="24">
					<path class="heroicon-ui"
						d="M12 22a10 10 0 110-20 10 10 0 010 20zm0-2a8 8 0 100-16 8 8 0 000 16zm1-9h2a1 1 0 010 2h-2v2a1 1 0 01-2 0v-2H9a1 1 0 010-2h2V9a1 1 0 012 0v2z" />
				</svg>
				<svg x-show="actionsOpen" @click="actionsOpen = false" class="fill-current" viewBox="0 0 24 24" width="24" height="24">
					<path class="heroicon-ui"
						d="M12 22a10 10 0 110-20 10 10 0 010 20zm0-2a8 8 0 100-16 8 8 0 000 16zm4-8a1 1 0 01-1 1H9a1 1 0 010-2h6a1 1 0 011 1z" />
				</svg>
				<br>
			</div>

			<div x-show="actionsOpen" x-collapse>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="loadEditor()" @keyup.window.prevent.ctrl.o="loadEditor()">
					<i class="far fa-folder-open col-span-1"></i>
					<span class="col-span-7">Load Entity</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="saveEntity(true)" @keyup.window.prevent.ctrl.shift.s="saveEntity(true)" @keyup.window.prevent.ctrl.s="saveEntity()">
					<i class="far fa-save col-span-1"></i>
					<span class="col-span-7">Save Entity</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="saveEntityAsPatch()" @keyup.window.prevent.ctrl.alt.s="saveEntityAsPatch()">
					<i class="far fa-save col-span-1"></i>
					<span class="col-span-7">Save Patch</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="deployMods()" @keyup.window.prevent.ctrl.alt.s="deployMods()">
					<i class="far fa-save col-span-1"></i>
					<span class="col-span-7">Deploy</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="runGame()" @keyup.window.prevent.ctrl.alt.s="runGame()">
					<i class="far fa-save col-span-1"></i>
					<span class="col-span-7">Run</span>
				</div>
				<div class="p-4 my-1 bg-gray-700 cursor-pointer grid grid-cols-8 gap-2 items-center" onclick="generateOverrideDeletes()" x-effect="$el.style.display = selectedView == 'overrides' ? 'grid' : 'none'">
					<i class="far fa-trash-alt col-span-1"></i>
					<span class="col-span-7">Delete Entities From Scene</span>
				</div>
				<br>
			</div>

			Credits to jsTree and Sigma.js for the tree view and graph view respectively.
		</div>
		<div class="col-span-7">
			<div id="tree">
				<div class="grid grid-cols-7 gap-8 w-full">
					<div class="col-span-3">
						<div class="mb-4">
							<label class="block mb-2" for="treeviewSearch">
								Filter
							</label>
							<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="treeviewSearch" type="text" placeholder="Search query">
						</div>
						<div class="mb-4 flow-root">
							<label class="inline-flex items-center float-left">
								<input type="checkbox" class="form-checkbox cursor-pointer h-5 w-5 text-gray-700 bg-white" oninput="editorTree.settings.search.fuzzy = !this.checked"><span class="ml-2">Exact search</span>
							</label>
							<label class="inline-flex items-center float-right">
								<input type="checkbox" class="form-checkbox cursor-pointer h-5 w-5 text-gray-700 bg-white" oninput="toggleContentSearch()"><span class="ml-2">Search content (overrides exact search)</span>
							</label>
						</div>
						<div id="treeviewSpace" class="treeview" style="overflow: auto;" x-init="if (window.visualViewport.height <= 1080) { $el.style.maxHeight = '66vh' } else { $el.style.maxHeight = '70vh' }"></div>
					</div>
					<div class="col-span-4">
						<div class="flow-root mb-1" x-data="{initialised: false, valid: true, reason: ''}" id="entityValidityData">
							<span class="text-3xl font-semibold float-left" id="entityName">QuickEntity Editor</span>
							<span class="text-xl font-semibold float-right" :class="valid ? 'text-green-400' : 'text-red-400'" x-text="initialised ? (valid ? 'Valid Entity' : reason) : ''" id="entityValidityIndicator"></span>
						</div>
						<div id="jsonEditorSpace" style="width: 100%" x-init="if (window.visualViewport.height <= 1080) { $el.style.height = '41vh' } else { $el.style.height = '45vh' }"></div><br id="jsonEditorBreak">
						<div id="visualEditorSpace" class="mt-2 pr-2" style="overflow: auto; display: none" x-init="if (window.visualViewport.height <= 1080) { $el.style.height = '41vh' } else { $el.style.height = '45vh' }"></div>
						<div id="commentEditorSpace" class="mt-2 pr-2" style="display: none" x-init="if (window.visualViewport.height <= 1080) { $el.style.height = '41vh' } else { $el.style.height = '45vh' }">
							<div class="mb-4">
								<label class="block mb-2" for="commentEditorName">
									Name
								</label>
								<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="commentEditorName" type="text" placeholder="Name of comment" @input="entity.entities[currentlySelected].name = $el.value">
							</div>
							<label class="block mb-2" for="commentEditorText">
								Text
							</label>
							<textarea class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="commentEditorText" placeholder="Content of comment" @input="entity.entities[currentlySelected].text = $el.value"></textarea>
						</div>
						<div id="refsSpace">
							<span class="text-2xl font-semibold mb-2">References</span><br>
							<div class="col-span-7 px-4 pb-4 mt-2 overflow-y-auto" style="height: 6.5vh">
								<div class="grid grid-cols-2 gap-2" id="entityProperties">References appear here</div>
							</div><br>
							<span class="text-2xl font-semibold mb-2">Referenced by</span><br>
							<div class="col-span-7 px-4 pb-4 mt-2 overflow-y-auto" style="height: 6.5vh">
								<div class="grid grid-cols-2 gap-2" id="entityReverseRefs">Reverse references appear here</div>
							</div>
							<div class="flex flex-initial flex-wrap flex-row justify-center px-2 w-full">
								<neo-button label="Collapse Tree" gradientFrom="from-rose-400" gradientTo="to-red-500" onclick="editorTree.close_all()">
									<i class="fas fa-compress-alt" slot="icon"></i>
								</neo-button>
								<neo-button label="Go to Previous Entity" gradientFrom="from-fuchsia-400" gradientTo="to-indigo-400" onclick="back()">
									<i class="fas fa-undo-alt" slot="icon"></i>
								</neo-button>
								<neo-button id="switchModeButton" label="Switch to Visual Mode" gradientFrom="from-pink-400" gradientTo="to-rose-400" onclick="switchEditMode()">
									<i class="fas fa-random" slot="icon"></i>
								</neo-button>
							</div>
						</div>
					</div>
				</div><br>
				
				<div id="infoModule" style="display: none; text-underline-position: auto">
					<span class="text-3xl w-full mb-2"><span id="infoModuleName" class="font-bold">ZActor</span> implements <span id="infoModuleBaseClasses">ZActor</span></span><br>
					<div class="flex justify-between items-top gap-8">
						<span class="text-2xl font-semibold pl-4" x-data="{ selectedInfo: 'properties' }">
							<span :class="selectedInfo == 'properties' ? 'underline text-gray-300' : 'text-white'" @click="window.selectedInfo = selectedInfo = 'properties'; refreshDocs(entity.entities[currentlySelected])">Properties</span><br>
							<span :class="selectedInfo == 'inputPins' ? 'underline text-gray-300' : 'text-white'" @click="window.selectedInfo = selectedInfo = 'inputPins'; refreshDocs(entity.entities[currentlySelected])">Inputs</span><br>
							<span :class="selectedInfo == 'outputPins' ? 'underline text-gray-300' : 'text-white'" @click="window.selectedInfo = selectedInfo = 'outputPins'; refreshDocs(entity.entities[currentlySelected])">Outputs</span>
						</span>
						<div class="grid grid-flow-col gap-8 overflow-x-auto pb-2" id="infoModuleDocs" style="grid-template-columns: repeat(auto-fill,minmax(25%,1fr)); grid-auto-columns: minmax(25%,1fr);"></div>
					</div>
				</div>
				
				<div id="infoTemplate" style="display: none">
					<span class="text-3xl w-full mb-2"><span id="infoTemplateName" class="font-bold">ZActor</span></span><span id="infoTemplateNoDocumentation">No documentation</span>
				</div>
			</div>
			<div id="metadata" style="display: none; width: 100%">
				<div class="grid grid-cols-4 gap-8">
					<div class="mb-4">
						<label class="block mb-2 text-xl font-bold" for="templateHashMetadata">
							Template hash
						</label>
						<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="templateHashMetadata" type="text" placeholder="Hash (not path)" oninput="entity.tempHash = this.value">
					</div>
					<div class="mb-4">
						<label class="block mb-2 text-xl font-bold" for="blueprintHashMetadata">
							Blueprint hash
						</label>
						<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="blueprintHashMetadata" type="text" placeholder="Hash (not path)" oninput="entity.tbluHash = this.value">
					</div>
					<div class="mb-4">
						<label class="block mb-2 text-xl font-bold" for="rootEntityMetadata">
							Root entity name
						</label>
						<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="rootEntityMetadata" type="text" placeholder="Name of entity" oninput="entity.rootEntity = this.value">
					</div>
					<div class="mb-4">
						<label class="block mb-2 text-xl font-bold" for="entitySubtypeMetadata">
							Entity subtype
						</label>
						<input class="shadow appearance-none border rounded w-full py-2 px-2.5 text-black" id="entitySubtypeMetadata" type="number" placeholder="Subtype of entity (number)" oninput="entity.subType = parseInt(this.value)">
					</div>
				</div>
				<neo-list-input id="externalScenesMetadata" x-data="{label: 'External scenes', placeholder: 'Hash or path'}" @input="entity.externalScenes = $el.value" @click="entity.externalScenes = $el.value"></neo-list-input>
			</div>
			<div id="overrides" style="display: none; width: 100%">
				<div id="overrideEditorSpace" style="width: 100%" x-init="if (window.visualViewport.height <= 1080) { $el.style.height = '84vh' } else { $el.style.height = '88vh' }" onkeyup="Object.assign(entity, LosslessJSON.parse(overrideEditor.getValue()))"></div>
			</div>
			<div id="graph" style="display: none; width: 100%">
				<div id="graphSpace" style="height: 75vh; width: 100%; background: #f6f6f6;"></div><br>
				<div class="flex flex-initial flex-wrap flex-row justify-left px-2 w-full">
					<label class="inline-flex items-center mx-6">
						<input type="checkbox" checked class="form-checkbox cursor-pointer h-5 w-5 text-gray-700 bg-white" oninput="editorGraphDisplay = editorGraphDisplay.filter(a=>a!='pins'); if (this.checked) {editorGraphDisplay.push('pins')}; refreshGraph()"><span class="ml-2">Display events</span>
					</label>
					<label class="inline-flex items-center mx-6">
						<input type="checkbox" class="form-checkbox cursor-pointer h-5 w-5 text-gray-700 bg-white" oninput="editorGraphDisplay = editorGraphDisplay.filter(a=>a!='parents'); if (this.checked) {editorGraphDisplay.push('parents')}; refreshGraph()"><span class="ml-2">Display hierarchy</span>
					</label>
					<label class="inline-flex items-center mx-6">
						<input type="checkbox" class="form-checkbox cursor-pointer h-5 w-5 text-gray-700 bg-white" oninput="editorGraphDisplay = editorGraphDisplay.filter(a=>a!='properties'); if (this.checked) {editorGraphDisplay.push('properties')}; refreshGraph()"><span class="ml-2">Display property references</span>
					</label>
				</div><br>
				<div class="flow-root">
					<input class="shadow appearance-none border rounded w-1/4 py-2 px-2.5 text-black float-left" id="graphFilter" type="text" placeholder="Filter nodes" oninput="editorGraphFilter = this.value; refreshGraph()">
					<input class="shadow appearance-none border rounded w-1/4 py-2 px-2.5 text-black float-right" id="graphEdgeFilter" type="text" placeholder="Filter connections" oninput="editorGraphEdgeFilter = this.value; refreshGraph()">
				</div>
			</div>
			<div id="pieGraph" style="display: none; height: calc(100vh - 128px); width: 100%">
				<iframe style="height: 100%; width: 100%;" id="pieGraphFrame" src="./piepieonline/graph/index.html"></iframe>
			</div>
			<div id="pie3DView" style="display: none; height: calc(100vh - 128px); width: 100%">
				<iframe style="height: 100%; width: 100%;" id="pie3DViewFrame" src="./piepieonline/3dview/index.html"></iframe>
			</div>
		</div>
	</section>
	<script defer src="editor.js"></script>
	<script defer src="neo-ui.js"></script>
</body>

</html>